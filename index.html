<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Useless Project</title>
    <!-- Use Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Set the fullscreen background image and font */
        body {
            font-family: 'Montserrat', sans-serif;
            background-image: url('photo.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* Glassmorphism effect for the main card */
        .glass-card {
            background-color: rgba(26, 32, 44, 0.75);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Style for the video and canvas elements */
        #video-feed, #captured-photo {
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            border-radius: 9999px; /* rounded-full */
            border: 5px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease-in-out;
        }

        #movie-video {
            width: 100%;
            height: auto;
            border-radius: 2rem; /* rounded-3xl */
            border: 5px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        /* Gradient for titles */
        .title-gradient {
            background-image: linear-gradient(to right, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Gradient for buttons */
        .button-gradient {
            background-image: linear-gradient(to right, #ff6b6b, #f0e130);
        }

        /* Custom Modal for error messages */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #1a202c;
            margin: auto;
            padding: 2rem;
            border: 1px solid #2d3748;
            border-radius: 1rem;
            max-width: 500px;
            text-align: center;
            color: white;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover, .close-button:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }

        /* Shutter effect animation */
        #shutter-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            opacity: 0;
            pointer-events: none;
            z-index: 90;
        }
        
        .shutter-flash-animation {
            animation: shutter-flash 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes shutter-flash {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-4">
    
    <!-- Shutter flash element -->
    <div id="shutter-flash"></div>

    <!-- Home Page (First "page") -->
    <div id="home-page" class="flex items-center justify-center w-full min-h-screen p-4">
        <div class="p-8 md:p-12 rounded-3xl shadow-2xl max-w-sm w-full text-center glass-card md:max-w-2xl">
            <h1 class="text-4xl font-bold mb-3 title-gradient">
                ഇങ്ങോട്ട് നോക്കടാ
            </h1>
            <p class="text-gray-300 mb-8 max-w-md mx-auto">
                നിന്റെ വിധി നീ ഇപ്പൊ അറിയും ...
            </p>
            <!-- Webcam feed and Take Photo button -->
            <div id="initial-state" class="flex flex-col items-center">
                <video id="video-feed" class="w-64 h-64 md:w-80 md:h-80 bg-slate-800" autoplay playsinline></video>
                <button id="take-photo-btn" class="mt-8 w-full md:w-3/4 py-4 px-6 rounded-full font-bold text-lg button-gradient hover:opacity-80 transition-all duration-300 transform hover:scale-105">
                    അങ്ങ് കാച്ചിക്കോ!!!
                </button>
            </div>
        </div>
    </div>

    <!-- Results Page (Second "page") - Hidden initially -->
    <div id="results-page" class="hidden flex items-center justify-center w-full min-h-screen p-4">
        <div id="results-page-container" class="p-8 md:p-12 rounded-3xl shadow-2xl max-w-sm w-full text-center glass-card md:max-w-7xl flex-col md:grid md:grid-cols-2 md:gap-24 items-center justify-center">
            
            <!-- Captured Photo Section -->
            <div class="section-panel flex flex-col items-center justify-center mb-10 md:mb-0 bg-slate-800/60 p-8 rounded-3xl glass-card">
                <h3 class="text-2xl font-semibold mb-6 title-gradient">ക്യാമറയിൽ പെട്ട മുഖം</h3>
                <canvas id="captured-photo" class="w-64 h-64 md:w-80 md:h-80"></canvas>
            </div>
            
            <!-- Video Player and Buttons Section -->
            <div class="section-panel flex flex-col items-center justify-center bg-slate-800/60 p-8 rounded-3xl glass-card">
                <h3 class="text-2xl font-semibold mb-6 title-gradient">വിധി...</h3>
                <video id="movie-video" autoplay playsinline class="mb-8"></video>
                <button id="retake-photo-btn" class="w-full py-4 px-6 rounded-full font-bold text-lg bg-slate-700 hover:bg-slate-600 text-white transition-colors duration-300 transform hover:scale-105">
                    ഒന്നൂടെ പിടിക്കാം!
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Modal for error messages -->
    <div id="error-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modal-text" class="text-lg"></p>
        </div>
    </div>
    
    <!-- Audio element for the shutter sound -->
    <audio id="shutter-sound" src="shutter.mp3"></audio>


    <script>
        // --- State Management ---
        let stream = null; // To store the webcam stream

        // List of your comedy video files.
        // IMPORTANT: Replace these with the actual filenames of your videos.
        const videos = [
            'jaryrm - saalam kashmir.mp4',
            'thakida thkida.mp4',
            'sunny-kuttan.mp4',
            'shajip.mp4'
        ];

        // --- DOM Elements ---
        const homePageEl = document.getElementById('home-page');
        const resultsPageEl = document.getElementById('results-page');
        const takePhotoBtn = document.getElementById('take-photo-btn');
        const retakePhotoBtn = document.getElementById('retake-photo-btn');
        const videoEl = document.getElementById('video-feed');
        const canvasEl = document.getElementById('captured-photo');
        const movieVideoEl = document.getElementById('movie-video');
        const shutterSound = document.getElementById('shutter-sound');
        const canvasCtx = canvasEl.getContext('2d');
        const errorModal = document.getElementById('error-modal');
        const modalText = document.getElementById('modal-text');
        const closeModalButton = document.querySelector('.close-button');
        const shutterFlashEl = document.getElementById('shutter-flash');


        // Function to show the custom error modal
        function showModal(message) {
            modalText.textContent = message;
            errorModal.style.display = 'flex';
        }

        // --- Event Handlers ---
        function handleDetect() {
            // Check if there are videos to play
            if (videos.length === 0) {
                showModal("Please add some videos to the 'videos' array in the code!");
                return;
            }

            // A crucial check to ensure the video has loaded and has dimensions
            if (videoEl.videoWidth === 0 || videoEl.videoHeight === 0) {
                showModal("Cannot capture photo. The webcam feed is not ready. Please try again.");
                return;
            }
            
            // Trigger the shutter flash animation
            shutterFlashEl.classList.add('shutter-flash-animation');
            // Play the shutter sound
            shutterSound.play();

            // Capture a still frame from the video feed
            canvasEl.width = videoEl.videoWidth;
            canvasEl.height = videoEl.videoHeight;
            canvasCtx.drawImage(videoEl, 0, 0, canvasEl.width, canvasEl.height);

            // Hide the home page and show the results page
            homePageEl.classList.add('hidden');
            resultsPageEl.classList.remove('hidden');

            // Play a random video
            displayRandomVideo();

            // Remove the animation class after it completes to allow it to be re-triggered
            setTimeout(() => {
                shutterFlashEl.classList.remove('shutter-flash-animation');
            }, 200);
        }

        function displayRandomVideo() {
            // Pick a random video from the list
            const randomIndex = Math.floor(Math.random() * videos.length);
            const randomFile = videos[randomIndex];
            
            // Set the video source and play it
            movieVideoEl.src = randomFile;
            movieVideoEl.load();
            movieVideoEl.play();
        }
        
        function handleRetakePhoto() {
            // Stop the audio
            shutterSound.pause();
            shutterSound.currentTime = 0;
            
            // Stop the webcam stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            // Hide the results page and show the home page
            resultsPageEl.classList.add('hidden');
            homePageEl.classList.remove('hidden');

            // Reset the state and start the camera again
            startCamera();
        }

        async function startCamera() {
            try {
                // Request access to the user's webcam
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoEl.srcObject = stream;
            } catch (err) {
                console.error("Could not access the webcam: ", err);
                // Fallback to the initial placeholder or show an error message
                showModal("Error: Could not access your webcam. Please check your camera permissions.");
            }
        }

        // --- Event Listeners ---
        takePhotoBtn.addEventListener('click', handleDetect);
        retakePhotoBtn.addEventListener('click', handleRetakePhoto);
        closeModalButton.addEventListener('click', () => {
            errorModal.style.display = 'none';
        });
        window.onclick = function(event) {
            if (event.target == errorModal) {
                errorModal.style.display = 'none';
            }
        }

        // Start the camera when the page loads
        window.addEventListener('load', startCamera);
    </script>
</body>
</html>
